<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>RTL AdAlliance Quiz - Ultimate V14</title>

  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <style>
    :root{
      --rtl-orange:#FF6600;
      --rtl-purple:#7B2CBF;
      --bg:#0b0b0b;
      --tile:#ffffff;
    }
    
    /* RESET & BASE */
    * { border-radius: 0px !important; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html,body,#root{height:100%; margin:0; font-family:Inter, system-ui, sans-serif; overflow: hidden; background: #000;}
    body{ background:linear-gradient(180deg,var(--bg), #090909); color:var(--tile); }
    
    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
    ::-webkit-scrollbar-thumb { background: var(--rtl-orange); }

    /* UTILS */
    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:8px; font-weight:900; padding:12px 20px; cursor:pointer; border:none; background:rgba(255,255,255,0.1); color:var(--tile); font-size:16px; transition: all 0.1s; text-transform: uppercase; letter-spacing: 1px; border: 1px solid rgba(255,255,255,0.1); user-select: none; }
    .btn:active { transform: scale(0.98); background:rgba(255,255,255,0.2); }
    .btn-host{ background:var(--rtl-orange); color:white; border-color: var(--rtl-orange); }
    .btn-host:hover { background: #ff7b24; }
    .btn-join{ background:var(--rtl-purple); color:white; border-color: var(--rtl-purple); }
    
    .card{ background: #111; border:1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    
    /* HOST LAYOUT */
    .host-screen{ display:flex; width: 100%; height:100vh; overflow:hidden; position: relative; background: var(--bg); }
    .host-main{ flex:1; display:flex; flex-direction:column; height: 100%; position: relative; }
    .game-top-bar { height: 110px; background: #000; border-bottom: 2px solid rgba(255,255,255,0.1); padding: 0 40px; display: flex; align-items: center; justify-content: space-between; }
    
    .countdown-badge{ width:70px; height:70px; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:900; border:4px solid rgba(255,255,255,0.15); background:#000; }
    .countdown-badge.warning{ border-color:var(--rtl-orange); color:var(--rtl-orange); }
    .countdown-badge.danger{ border-color:#ef4444; color:#ef4444; }
    
    /* PLAYER INVENTORY MOBILE OPTIMIZED */
    .inventory-slot {
        width: 60px; height: 60px; 
        background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1);
        display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative;
        transition: all 0.2s;
    }
    @media (max-width: 600px) {
        .inventory-slot { width: 50px; height: 50px; }
        .inventory-slot .item-icon { font-size: 24px; }
    }
    .inventory-slot.filled { border-color: rgba(255,255,255,0.5); background: rgba(255,255,255,0.1); }
    .item-tag { padding: 2px 4px; font-size: 9px; font-weight: 900; text-transform: uppercase; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); background: #000; border: 1px solid #333; white-space: nowrap; z-index: 10; }
    
    /* RARITY COLORS */
    .rarity-common { color: #fff; border-color: #fff !important; }
    .rarity-uncommon { color: #a3e635; border-color: #a3e635 !important; }
    .rarity-rare { color: #3b82f6; border-color: #3b82f6 !important; }
    .rarity-legendary { color: #eab308; border-color: #eab308 !important; box-shadow: 0 0 10px rgba(234,179,8,0.2); }

    /* EFFECTS & ANIMATIONS */
    .effect-overlay { position: absolute; inset: 0; pointer-events: none; z-index: 50; display: flex; align-items: center; justify-content: center; font-size: 3rem; font-weight: 900; text-transform: uppercase; animation: pulse 1s infinite; background: rgba(0,0,0,0.7); backdrop-filter: blur(2px); text-align: center; padding: 20px; }
    .effect-freeze { color: #00ffff; text-shadow: 0 0 20px blue; border: 10px solid #00ffff; }
    @keyframes pulse { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }

    /* ROULETTE ANIMATION */
    .roulette-overlay { position: fixed; inset: 0; z-index: 100; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
    .roulette-box { width: 120px; height: 120px; background: #222; border: 5px solid var(--rtl-orange); display: flex; align-items: center; justify-content: center; font-size: 60px; box-shadow: 0 0 50px var(--rtl-orange); animation: bounce 0.5s infinite alternate; }
    @keyframes bounce { from { transform: scale(1); } to { transform: scale(1.1); } }

    .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,0.9); display:flex; align-items:center; justify-content:center; z-index:9999; padding: 20px; }
    .modal-card{ width:100%; max-width:500px; background:#1a1a1a; border:2px solid var(--rtl-orange); padding:30px; color:var(--tile); text-align: center; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
    
    .confetti { position: absolute; width: 10px; height: 10px; background: #f00; animation: fall 3s linear infinite; z-index: 0; }
    @keyframes fall { 0% { transform: translateY(-10vh) rotate(0deg); opacity: 1;} 100% { transform: translateY(110vh) rotate(720deg); opacity: 0; } }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
  const { useState, useEffect, useRef } = React;

  /************ CONFIG ************/
  const QUESTIONS_PER_ROUND = 2;
  const TOTAL_ROUNDS = 4;
  const QUESTION_TIME = 60; 
  const FINAL_QUESTIONS = 5;
  const FINAL_TIME = 60;
  
  const ROUND_POINTS = { 1: 100, 2: 200, 3: 400, 4: 800 };
  const FINAL_ROUND_POINTS = [500, 750, 1000, 1500, 2000];

  const firebaseConfig = {
    apiKey: "AIzaSyCsxAEsivsJVFVcnerdAWezFpruoCv7Z2I",
    authDomain: "qiuz-64055.firebaseapp.com",
    databaseURL: "https://qiuz-64055-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "qiuz-64055",
    storageBucket: "qiuz-64055.firebasedatabase.app",
    messagingSenderId: "605853616985",
    appId: "1:605853616985:web:95579b246a10d89ba51a48"
  };
  if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  /************ ITEMS DEFINITION ************/
  const ITEM_DEFS = {
    BOOST: { id: 'BOOST', name: 'Turbo', icon: 'üöÄ', desc: '+50% Punkte', type: 'SELF', rarity: 'COMMON' },
    SHIELD: { id: 'SHIELD', name: 'Schild', icon: 'üõ°Ô∏è', desc: 'Schutz', type: 'SELF', rarity: 'COMMON' },
    POISON: { id: 'POISON', name: 'Gift', icon: '‚ò†Ô∏è', desc: '-25% Punkte (Gegner)', type: 'TARGET', rarity: 'UNCOMMON' },
    FREEZE: { id: 'FREEZE', name: 'Eis', icon: '‚ùÑÔ∏è', desc: 'Blockiert 10s', type: 'TARGET', rarity: 'UNCOMMON' },
    TIME_SNATCH: { id: 'TIME_SNATCH', name: 'Zeit', icon: '‚è≥', desc: 'Halbe Zeit (Gegner)', type: 'TARGET', rarity: 'RARE' },
    MIRROR: { id: 'MIRROR', name: 'Spiegel', icon: 'üìä', desc: 'Zeigt Stats', type: 'SELF', rarity: 'RARE' },
    MAGNET: { id: 'MAGNET', name: 'Magnet', icon: 'üß≤', desc: 'Mehrheits-Bonus', type: 'SELF', rarity: 'UNCOMMON' },
    HINT: { id: 'HINT', name: '50/50', icon: 'üí°', desc: 'Entfernt 2 Falsche', type: 'SELF', rarity: 'RARE' },
    SPY: { id: 'SPY', name: 'Scanner', icon: 'üî¶', desc: 'Spioniert Antwort', type: 'TARGET', rarity: 'RARE' },
    SWAP: { id: 'SWAP', name: 'Tausch', icon: 'üé≠', desc: 'Punkte Tausch!', type: 'SELF', rarity: 'LEGENDARY' }
  };
  const ITEM_KEYS = Object.keys(ITEM_DEFS);

  function getRandomItem(normalizedRank) {
    let pool = [];
    if (normalizedRank > 0.75) pool = ['SWAP','HINT','TIME_SNATCH','FREEZE','MIRROR','POISON','SPY'];
    else if (normalizedRank > 0.4) pool = ['POISON','FREEZE','MAGNET','SHIELD','BOOST','HINT'];
    else pool = ['SHIELD','BOOST','MAGNET','POISON'];
    const itemId = pool[Math.floor(Math.random() * pool.length)];
    return ITEM_DEFS[itemId];
  }

  /* LOGO COMPONENT (LOCAL) */
  function RTLLogo({ size = "md" }) {
    const h = size === 'lg' ? 80 : 50;
    return <img src="Logo.png" alt="Logo" style={{height: h, width: 'auto', objectFit: 'contain'}} onError={(e)=>{e.target.style.display='none';}} />; 
  }

  /* QR & HELPERS */
  function qrUrlForGame(gameId){
    const url = `${window.location.origin}${window.location.pathname}?join=${gameId}`;
    return `https://quickchart.io/qr?text=${encodeURIComponent(url)}&size=500&margin=1&dark=000000&light=ffffff`;
  }
  function shuffle(arr){ const a=[...arr]; for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[i],a[j]];} return a; }
  function randomGameID(){ return Math.random().toString(36).substr(2,6).toUpperCase(); }
  function makePlayerId(){ return Date.now().toString(36) + Math.random().toString(36).substr(2,4); }
  function ConfettiRain() {
     const particles = Array.from({length: 50});
     return (
        <div style={{position:'fixed', inset:0, pointerEvents:'none', overflow:'hidden', zIndex:0}}>
           {particles.map((_, i) => (
              <div key={i} className="confetti" style={{
                 left: Math.random() * 100 + 'vw',
                 animationDelay: Math.random() * 3 + 's',
                 backgroundColor: ['#FF6600', '#7B2CBF', '#FFF'][Math.floor(Math.random()*3)]
              }} />
           ))}
        </div>
     )
  }

  /* CONTENT */
  const CATEGORY_LIST = ["Geografie", "Wissenschaft", "Geschichte", "Kultur", "Sport", "Tech"];
  const QUESTION_POOL = [
    { question: "Welches Land hat die l√§ngste K√ºstenlinie?", answers: ["USA","Kanada","Australien","China"], correct: 1, category: "Geografie" },
    { question: "Hauptstadt von Australien?", answers: ["Sydney","Melbourne","Canberra","Perth"], correct: 2, category: "Geografie" },
    { question: "Chem. Symbol f√ºr Gold?", answers: ["Ag","Au","Fe","Go"], correct: 1, category: "Wissenschaft" },
    { question: "Erster Mensch im All?", answers: ["Armstrong","Gagarin","Aldrin","Laika"], correct: 1, category: "Geschichte" },
    { question: "Farben der Google-Logos?", answers: ["4","5","3","6"], correct: 0, category: "Tech" },
    { question: "Wann fiel die Berliner Mauer?", answers: ["1988","1989","1990","1991"], correct: 1, category: "Geschichte" },
    { question: "Wie viele Spieler beim Volleyball?", answers: ["5","6","7","8"], correct: 1, category: "Sport" },
    { question: "Was ist KEIN Browser?", answers: ["Chrome","Firefox","Edge","Windows"], correct: 3, category: "Tech" },
  ];
  const FINAL_QUESTION_POOL = [
    { question: "In welchem Jahr fiel die Berliner Mauer?", answer: "1989" },
    { question: "Wie hei√üt der h√∂chste Berg Deutschlands?", answer: "Zugspitze" },
    { question: "Wie viele Bundesl√§nder hat Deutschland?", answer: "16" },
    { question: "Welches Element ist O?", answer: "Sauerstoff" },
    { question: "Hauptstadt von Frankreich?", answer: "Paris" }
  ];

  function getQuestionsForCategory(cat, count, used=[]){
      let pool = QUESTION_POOL.filter(q=>!used.includes(q.question));
      if(pool.length < count) pool = QUESTION_POOL; // fallback
      return shuffle(pool).slice(0,count).map((q,i)=>({id:`${cat}-${i}-${Date.now()}`, ...q, category: cat}));
  }

  /* --- COMPONENTS --- */

  /* ITEM ROULETTE ANIMATION COMPONENT */
  function ItemRouletteOverlay({ onComplete, targetItem }) {
      const [displayIcon, setDisplayIcon] = useState('‚ùì');
      
      useEffect(() => {
          let speed = 50;
          let rounds = 0;
          let interval;
          
          const spin = () => {
             const randomKey = ITEM_KEYS[Math.floor(Math.random() * ITEM_KEYS.length)];
             setDisplayIcon(ITEM_DEFS[randomKey].icon);
             
             if(rounds > 20) speed += 20; // Slow down
             if(speed > 300) {
                 clearInterval(interval);
                 setDisplayIcon(targetItem.icon);
                 setTimeout(onComplete, 1500); // Show final item for 1.5s
             } else {
                 clearInterval(interval);
                 interval = setInterval(spin, speed);
             }
             rounds++;
          };
          
          interval = setInterval(spin, speed);
          return () => clearInterval(interval);
      }, []);

      return (
          <div className="roulette-overlay">
              <h2 className="text-[var(--rtl-orange)] text-3xl font-black mb-10 uppercase tracking-widest">Item Box</h2>
              <div className="roulette-box">
                  {displayIcon}
              </div>
              <div className="text-white mt-8 font-bold text-xl animate-pulse">
                  Wird ausgelost...
              </div>
          </div>
      );
  }

  function StartScreen({ onCreate, onJoin }){
    const [name,setName] = useState('');
    const [code,setCode] = useState('');
    return (
      <div className="min-h-screen flex items-center justify-center p-6 bg-black">
        <div className="card w-full max-w-md text-center">
          <div className="flex justify-center mb-6"><RTLLogo size="md" /></div>
          <h1 className="text-2xl font-black text-white mb-6">QUIZ MAYHEM</h1>
          <input className="w-full mb-4 text-center text-lg" placeholder="Dein Name" value={name} onChange={e=>setName(e.target.value)} />
          <div className="flex gap-2">
              <button className="btn btn-host flex-1" onClick={()=>onCreate(name)} disabled={!name}>HOST</button>
              <div className="flex-1 flex gap-2">
                  <input className="w-20 text-center p-0 font-black uppercase" placeholder="CODE" value={code} onChange={e=>setCode(e.target.value.toUpperCase())} />
                  <button className="btn btn-join flex-1" onClick={()=>onJoin(name,code)} disabled={!name||!code}>JOIN</button>
              </div>
          </div>
        </div>
      </div>
    );
  }

  function HostScreen({ gameId }){
      const [game, setGame] = useState(null);
      const [meta, setMeta] = useState(null);
      const [timeLeft, setTimeLeft] = useState(0);
      const [reveal, setReveal] = useState(false);
      const [judged, setJudged] = useState({});
      const timerRef = useRef(null);

      useEffect(()=>{
          const ref = db.ref(`games/${gameId}`);
          ref.on('value', s => { setGame(s.val()); setMeta(s.val()?.meta); });
          return () => { ref.off(); clearInterval(timerRef.current); };
      }, [gameId]);

      // TIMER LOGIC
      useEffect(() => {
          if(!meta) return;
          const isFinal = meta.phase === 'finalQuestion';
          const start = isFinal ? meta.finalQuestionStartTime : meta.questionStartTime;
          const duration = isFinal ? FINAL_TIME : QUESTION_TIME;

          if(start && (meta.phase === 'question' || isFinal)){
              clearInterval(timerRef.current);
              timerRef.current = setInterval(() => {
                  const elapsed = (Date.now() - start) / 1000;
                  const rem = Math.max(0, Math.floor(duration - elapsed));
                  setTimeLeft(rem);
                  if(rem <= 0) { 
                      clearInterval(timerRef.current); 
                      if(isFinal) nextFinalQuestion();
                      else showResultsNow();
                  }
              }, 500);
          } else { setTimeLeft(0); clearInterval(timerRef.current); }
          return () => clearInterval(timerRef.current);
      }, [meta?.phase, meta?.questionStartTime, meta?.finalQuestionStartTime]);

      useEffect(() => {
          if(meta?.phase === 'results') { setReveal(false); setTimeout(()=>setReveal(true), 3000); }
      }, [meta?.phase]);

      /* --- HOST ACTIONS --- */
      const startGame = async () => {
          const cats = shuffle(CATEGORY_LIST);
          const q = getQuestionsForCategory(cats[0], QUESTIONS_PER_ROUND);
          await db.ref(`games/${gameId}`).update({
              questions: q,
              meta: { phase: 'question', round: 1, questionIndex: 0, questionStartTime: Date.now(), currentCategory: cats[0], categoryState: { used: [cats[0]] } }
          });
      };

      const showResultsNow = async () => {
          if(meta.phase === 'results') return;
          const q = game.questions[meta.questionIndex];
          const updates = {};
          const playersArr = Object.entries(game.players).map(([pid,p])=>({pid,...p}));
          const sortedPlayers = [...playersArr].sort((a,b)=>b.score-a.score);
          
          playersArr.forEach(({pid, ...p}) => {
              let pts = (p.currentAnswer === q.correct) ? ROUND_POINTS[meta.round] : 0;
              
              // ITEM LOGIC
              if(p.activeEffects?.BOOST && pts > 0) pts = Math.round(pts * 1.5);
              
              // Poison (incoming)
              const poisonCount = p.activeEffects?.poisonedBy?.length || 0;
              if(poisonCount && !p.activeEffects?.SHIELD) pts -= Math.round(pts * 0.25 * poisonCount);
              
              // Swap Logic handled simply here (last swap wins or random if multiple)
              // For robustness in this version, we skip complex swap chains and just apply basics

              updates[`games/${gameId}/players/${pid}/score`] = (p.score||0) + Math.round(pts);
              updates[`games/${gameId}/players/${pid}/lastPoints`] = Math.round(pts);
              
              // LOOTBOX GENERATION
              if((p.inventory||[]).length < 2) {
                  const rank = sortedPlayers.findIndex(x=>x.pid===pid) / Math.max(1, sortedPlayers.length-1);
                  const newItem = getRandomItem(rank);
                  const inv = p.inventory || [];
                  inv.push(newItem);
                  updates[`games/${gameId}/players/${pid}/inventory`] = inv;
              }
          });
          
          await db.ref().update(updates);
          await db.ref(`games/${gameId}/meta/phase`).set('results');
      };

      const startNextRound = async () => {
          const curIdx = meta.questionIndex;
          const nextIdx = curIdx + 1;
          const isRoundEnd = (nextIdx % QUESTIONS_PER_ROUND) === 0;
          
          if (isRoundEnd) {
              const round = Math.floor(curIdx / QUESTIONS_PER_ROUND) + 1;
              if(round > TOTAL_ROUNDS) {
                  // START FINALE
                  const pArr = Object.entries(game.players).map(([pid,p])=>({pid,...p})).sort((a,b)=>(b.score||0)-(a.score||0));
                  const finalists = pArr.slice(0,2).map(p=>p.pid);
                  await db.ref(`games/${gameId}/meta`).update({ phase: 'finalIntro', finalists });
                  await db.ref(`games/${gameId}/finalQuestions`).set(FINAL_QUESTION_POOL);
                  // Reset Finale States
                  const updates = {};
                  Object.keys(game.players).forEach(pid => {
                      updates[`games/${gameId}/players/${pid}/isFinalist`] = finalists.includes(pid);
                      updates[`games/${gameId}/players/${pid}/finalistReady`] = false;
                      updates[`games/${gameId}/players/${pid}/finalAnswers`] = null;
                  });
                  await db.ref().update(updates);
                  return;
              }
              // Determine loser for category pick
               const sorted = Object.entries(game.players).sort((a,b)=>a[1].score-b[1].score);
               const loserId = sorted[0][0];
               await db.ref(`games/${gameId}/meta`).update({ phase: 'roundSummary', round: round, categoryChooserCandidate: loserId });
          } else {
              await proceedToQuestion(nextIdx, meta.currentCategory);
          }
      };

      const proceedCategory = async () => {
           // Called after Round Summary
           let cat = meta.nextCategory;
           if(!cat) cat = CATEGORY_LIST.find(c => !meta.categoryState.used.includes(c));
           const newQ = getQuestionsForCategory(cat, QUESTIONS_PER_ROUND, game.questions.map(q=>q.question));
           await db.ref(`games/${gameId}/questions`).set([...game.questions, ...newQ]);
           
           const used = [...meta.categoryState.used, cat];
           await db.ref(`games/${gameId}/meta/categoryState/used`).set(used);
           await db.ref(`games/${gameId}/meta/nextCategory`).remove();
           await db.ref(`games/${gameId}/meta/categoryChooserCandidate`).remove();
           
           await proceedToQuestion(game.questions.length, cat);
      }

      const proceedToQuestion = async (index, category) => {
          const updates = {};
          Object.keys(game.players).forEach(pid => {
              updates[`games/${gameId}/players/${pid}/currentAnswer`] = null;
              updates[`games/${gameId}/players/${pid}/activeEffects`] = null;
          });
          await db.ref().update(updates);
          await db.ref(`games/${gameId}/meta`).update({ 
               phase: 'question', 
               questionIndex: index, 
               questionStartTime: Date.now(),
               currentCategory: category
           });
      };

      /* FINALE ACTIONS */
      const startFinalQuestion = async () => {
          await db.ref(`games/${gameId}/meta`).update({ phase: 'finalQuestion', finalQuestionIndex: 0, finalQuestionStartTime: Date.now() });
      };
      const nextFinalQuestion = async () => {
          const cur = (meta.finalQuestionIndex || 0) + 1;
          if(cur >= FINAL_QUESTIONS) await db.ref(`games/${gameId}/meta`).update({ phase: 'finalReview', finalReviewIndex: 0 });
          else await db.ref(`games/${gameId}/meta`).update({ finalQuestionIndex: cur, finalQuestionStartTime: Date.now() });
      };
      const judgeFinalAnswer = async (pid, ok) => {
          const revIdx = meta.finalReviewIndex || 0;
          const pts = ok ? (FINAL_ROUND_POINTS[revIdx] || 2000) : 0;
          const p = game.players[pid];
          await db.ref(`games/${gameId}/players/${pid}`).update({ score: (p.score||0) + pts });
          setJudged(prev => ({...prev, [pid]: ok}));
      };
      const nextFinalReview = async () => {
          const revIdx = (meta.finalReviewIndex || 0) + 1;
          setJudged({});
          if(revIdx >= FINAL_QUESTIONS) await db.ref(`games/${gameId}/meta`).update({ phase: 'finished' });
          else await db.ref(`games/${gameId}/meta`).update({ finalReviewIndex: revIdx });
      };


      if(!game || !meta) return <div className="flex items-center justify-center h-screen text-white">Lade...</div>;
      
      if(meta.phase === 'lobby') {
          return (
              <div className="host-screen flex-col">
                  <div className="flex-1 flex items-center justify-center bg-[#111] border-b border-white/10">
                      <div className="text-center">
                          <img src={qrUrlForGame(gameId)} className="w-64 h-64 mx-auto border-4 border-white" />
                          <div className="mt-6 text-gray-400 tracking-widest uppercase">Code</div>
                          <div className="text-8xl font-black text-white font-mono">{gameId}</div>
                      </div>
                  </div>
                  <div className="h-1/3 p-6 bg-black">
                      <div className="flex justify-between items-center mb-4">
                          <h2 className="text-2xl font-black text-[var(--rtl-orange)]">SPIELER ({Object.keys(game.players||{}).length})</h2>
                          <button className="btn btn-host text-xl px-8" onClick={startGame}>STARTEN ‚ñ∂</button>
                      </div>
                      <div className="flex flex-wrap gap-4">
                          {Object.values(game.players||{}).map((p,i)=>(<div key={i} className="bg-white/10 px-4 py-2 font-bold flex items-center gap-2">{p.name}<span className="text-[var(--rtl-orange)]">‚óè</span></div>))}
                      </div>
                  </div>
              </div>
          )
      }
      
      const q = game.questions ? game.questions[meta.questionIndex] : null;
      
      return (
          <div className="host-screen flex-col">
             {meta.phase !== 'finalIntro' && meta.phase !== 'finished' && (
              <div className="game-top-bar">
                  <div className="flex items-center gap-6">
                      {(meta.phase==='question' || meta.phase==='finalQuestion') && <div className="countdown-badge text-[var(--rtl-orange)] border-[var(--rtl-orange)]">{timeLeft}</div>}
                      <div>
                          <div className="text-gray-500 text-sm uppercase tracking-widest">
                              {meta.phase.includes('final') ? 'FINALE' : `Runde ${meta.round}`}
                          </div>
                          <div className="text-3xl font-black text-white uppercase">
                              {meta.phase==='roundSummary'?'Zwischenstand': (meta.phase.includes('final') ? 'Showdown' : meta.currentCategory)}
                          </div>
                      </div>
                  </div>
                  <div>
                      {meta.phase==='question' && <button className="btn btn-host" onClick={showResultsNow}>AUFL√ñSEN ‚ñ∂</button>}
                      {meta.phase==='results' && <button className="btn btn-host" onClick={startNextRound}>WEITER ‚ñ∂</button>}
                      {meta.phase==='roundSummary' && <button className="btn btn-host" onClick={proceedCategory}>N√ÑCHSTE RUNDE ‚ñ∂</button>}
                      {meta.phase==='finalQuestion' && <button className="btn btn-host" onClick={nextFinalQuestion}>STOP / REVIEW ‚ñ∂</button>}
                      {meta.phase==='finalReview' && Object.keys(judged).length === (meta.finalists||[]).length && <button className="btn btn-host" onClick={nextFinalReview}>WEITER ‚ñ∂</button>}
                  </div>
              </div>
             )}
             
             <div className="host-main-inner relative">
                 {/* NORMAL QUESTION */}
                 {meta.phase === 'question' && q && (
                     <>
                         <div className="flex-1 flex items-center justify-center p-10">
                             <h1 className="text-5xl font-black text-center leading-tight">{q.question}</h1>
                         </div>
                         <div className="grid grid-cols-2 gap-4 h-64">
                             {q.answers.map((a,i)=>(
                                 <div key={i} className="bg-white text-black p-6 flex items-center text-3xl font-bold">
                                     <span className="text-[var(--rtl-orange)] mr-4 font-black">{String.fromCharCode(65+i)}</span> {a}
                                 </div>
                             ))}
                         </div>
                     </>
                 )}
                 
                 {/* RESULTS */}
                 {meta.phase === 'results' && q && (
                     <div className="flex h-full gap-6">
                         <div className="flex-1 flex flex-col gap-4 justify-center">
                             {q.answers.map((a,i)=>{
                                 const isCorrect = i===q.correct;
                                 return (
                                     <div key={i} className={`p-6 border-2 ${isCorrect && reveal ? 'bg-white text-black border-white scale-105' : 'bg-white/5 border-white/10 text-gray-500'} transition-all duration-500`}>
                                         <div className="text-2xl font-bold flex justify-between">
                                             <span>{String.fromCharCode(65+i)}. {a}</span>
                                             {isCorrect && reveal && <span>‚úÖ</span>}
                                         </div>
                                     </div>
                                 )
                             })}
                         </div>
                         <div className="w-1/3 bg-white/5 border border-white/10 p-4 overflow-y-auto">
                             {/* ACTIONS LOG */}
                             <div className="mb-4 text-sm text-gray-400">
                                 {(game.meta.actions?.[meta.questionIndex] || []).map((act,i) => (
                                     <div key={i} className="mb-1 border-l-2 border-[var(--rtl-purple)] pl-2">
                                         {ITEM_DEFS[act.type]?.icon} {game.players[act.from]?.name}
                                     </div>
                                 ))}
                             </div>
                             {reveal && Object.values(game.players).sort((a,b)=>b.lastPoints-a.lastPoints).map((p,i)=>(
                                 <div key={i} className="flex justify-between p-2 border-b border-white/5">
                                     <span className="font-bold">{p.name}</span>
                                     <span className={p.lastPoints>0?'text-[var(--rtl-orange)]':'text-gray-500'}>+{p.lastPoints}</span>
                                 </div>
                             ))}
                         </div>
                     </div>
                 )}
                 
                 {/* ROUND SUMMARY */}
                 {meta.phase === 'roundSummary' && (
                     <div className="flex flex-col items-center h-full">
                         <h2 className="text-[var(--rtl-orange)] text-4xl font-black mb-8">TOP LISTE</h2>
                         <div className="w-full max-w-3xl space-y-3 overflow-y-auto pb-10">
                             {Object.values(game.players).sort((a,b)=>b.score-a.score).map((p,i)=>(
                                 <div key={i} className={`p-4 flex justify-between items-center ${i===0?'bg-yellow-500/20 border-l-4 border-yellow-500':'bg-white/5'}`}>
                                     <div className="flex items-center gap-4">
                                         <span className="text-2xl font-black w-10 text-gray-500">{i+1}.</span>
                                         <span className="text-xl font-bold">{p.name}</span>
                                     </div>
                                     <div className="flex gap-4 items-center">
                                        <div className="flex gap-1">{(p.inventory||[]).map((it,k)=><span key={k}>{it.icon}</span>)}</div>
                                        <span className="text-3xl font-black">{p.score}</span>
                                     </div>
                                 </div>
                             ))}
                         </div>
                         {meta.categoryChooserCandidate && (
                             <div className="absolute bottom-10 bg-[var(--rtl-orange)] text-black px-8 py-4 font-black animate-pulse">
                                 {game.players[meta.categoryChooserCandidate]?.name} W√ÑHLT KATEGORIE...
                             </div>
                         )}
                     </div>
                 )}

                 {/* FINALE SCREENS */}
                 {meta.phase === 'finalIntro' && (
                     <div className="flex flex-col items-center justify-center h-full">
                         <h2 className="text-8xl font-black text-[var(--rtl-orange)] mb-10">FINALE</h2>
                         <div className="flex gap-20">
                             {(meta.finalists||[]).map(pid => (
                                 <div key={pid} className={`p-10 border-4 ${game.players[pid].finalistReady ? 'border-[var(--rtl-orange)] bg-[var(--rtl-orange)] text-black':'border-white/10'} w-80 text-center`}>
                                     <div className="text-4xl font-black">{game.players[pid].name}</div>
                                     <div className="mt-4 font-bold">{game.players[pid].finalistReady ? 'BEREIT' : 'WARTEN...'}</div>
                                 </div>
                             ))}
                         </div>
                         {(meta.finalists||[]).every(pid => game.players[pid]?.finalistReady) && 
                             <button className="btn btn-host text-3xl px-10 py-6 mt-20" onClick={startFinalQuestion}>STARTEN ‚ñ∂</button>
                         }
                     </div>
                 )}

                 {meta.phase === 'finalQuestion' && (
                     <div className="flex flex-col items-center justify-center h-full pt-20">
                         <h2 className="text-6xl font-black mb-20 px-20 text-center">{(game.finalQuestions||[])[meta.finalQuestionIndex]?.question}</h2>
                         <div className="flex gap-10">
                             {(meta.finalists||[]).map(pid => {
                                 const hasAns = game.players[pid].finalAnswers?.[meta.finalQuestionIndex];
                                 return (
                                     <div key={pid} className={`p-10 border-2 ${hasAns ? 'border-[var(--rtl-orange)] bg-[var(--rtl-orange)] text-black':'border-white/20'} w-80 text-center`}>
                                         <div className="text-3xl font-black">{game.players[pid].name}</div>
                                         <div className="mt-4">{hasAns ? 'EINGELOGGT' : 'tippt...'}</div>
                                     </div>
                                 )
                             })}
                         </div>
                     </div>
                 )}

                 {meta.phase === 'finalReview' && (
                     <div className="flex h-full gap-10 p-10">
                         <div className="flex-1 flex flex-col justify-center bg-white/5 p-10">
                             <div className="text-gray-500 uppercase">Frage</div>
                             <div className="text-3xl font-black mb-10">{(game.finalQuestions||[])[meta.finalReviewIndex]?.question}</div>
                             <div className="bg-white text-black p-8">
                                 <div className="text-[var(--rtl-orange)] font-black uppercase">L√∂sung</div>
                                 <div className="text-5xl font-black">{(game.finalQuestions||[])[meta.finalReviewIndex]?.answer}</div>
                             </div>
                         </div>
                         <div className="w-1/3 flex flex-col gap-6 justify-center">
                             {(meta.finalists||[]).map(pid => {
                                 const p = game.players[pid];
                                 const ans = p.finalAnswers?.[meta.finalReviewIndex] || '---';
                                 const isJudged = judged[pid] !== undefined;
                                 return (
                                     <div key={pid} className="p-6 border border-white/20 bg-white/5">
                                         <div className="flex justify-between mb-2">
                                             <span className="font-bold">{p.name}</span>
                                             <span>{p.score}</span>
                                         </div>
                                         <div className="text-2xl font-mono bg-black/50 p-4 mb-4 border-l-4 border-white">"{ans}"</div>
                                         {!isJudged ? (
                                             <div className="flex gap-2">
                                                 <button className="btn flex-1 bg-green-600" onClick={()=>judgeFinalAnswer(pid, true)}>‚úî</button>
                                                 <button className="btn flex-1 bg-red-600" onClick={()=>judgeFinalAnswer(pid, false)}>‚úò</button>
                                             </div>
                                         ) : (
                                             <div className={`text-center font-black text-xl ${judged[pid]?'text-green-500':'text-red-500'}`}>{judged[pid]?'PUNKTE':'FALSCH'}</div>
                                         )}
                                     </div>
                                 )
                             })}
                         </div>
                     </div>
                 )}

                 {meta.phase === 'finished' && (
                     <div className="flex flex-col items-center justify-center h-full relative z-10">
                         <ConfettiRain />
                         <h1 className="text-8xl font-black text-[var(--rtl-orange)] mb-10">SIEGER</h1>
                         <div className="flex items-end gap-10">
                            {/* Simple Podium Logic */}
                            {Object.values(game.players).sort((a,b)=>b.score-a.score).slice(0,3).map((p,i)=>(
                                <div key={i} className={`text-center ${i===0?'order-2 scale-125':i===1?'order-1':i===2?'order-3':''}`}>
                                    <div className="text-4xl mb-2">{p.name}</div>
                                    <div className={`flex items-end justify-center pb-4 text-4xl font-black ${i===0?'h-60 w-40 bg-yellow-500 text-black':i===1?'h-40 w-32 bg-gray-500': 'h-32 w-32 bg-orange-700'}`}>{i+1}</div>
                                    <div className="mt-2 font-bold">{p.score}</div>
                                </div>
                            ))}
                         </div>
                         <button className="btn mt-20 z-50" onClick={()=>window.location.reload()}>NEUES SPIEL</button>
                     </div>
                 )}
             </div>
          </div>
      );
  }

  function PlayerView({ gameId, playerId }){
      const [game, setGame] = useState(null);
      const [player, setPlayer] = useState(null);
      const [timeLeft, setTimeLeft] = useState(0);
      
      // UI STATE
      const [showRoulette, setShowRoulette] = useState(false);
      const [newestItem, setNewestItem] = useState(null);
      const [confirmationItem, setConfirmationItem] = useState(null); 
      const [targetModalItem, setTargetModalItem] = useState(null);
      const [catModal, setCatModal] = useState(false);
      const [reveal, setReveal] = useState(false);
      const [finalAns, setFinalAns] = useState('');

      // LOCAL LOGIC STATE
      const [freeze, setFreeze] = useState(false);
      const inventoryRef = useRef([]);

      useEffect(()=>{
          const ref = db.ref(`games/${gameId}`);
          ref.on('value', s => {
              const g = s.val();
              setGame(g);
              if(g?.players?.[playerId]) {
                  const p = g.players[playerId];
                  setPlayer(p);
                  
                  const oldInv = inventoryRef.current;
                  const newInv = p.inventory || [];
                  if(newInv.length > oldInv.length) {
                      setNewestItem(newInv[newInv.length-1]);
                      setShowRoulette(true);
                  }
                  inventoryRef.current = newInv;
                  
                  if(p.activeEffects?.FREEZE) setFreeze(true);
                  else setFreeze(false);
              }
          });
          return () => ref.off();
      }, [gameId, playerId]);

      useEffect(() => {
          if(game?.meta) {
              const isFinal = game.meta.phase === 'finalQuestion';
              const start = isFinal ? game.meta.finalQuestionStartTime : game.meta.questionStartTime;
              const duration = isFinal ? FINAL_TIME : QUESTION_TIME;
              
              if((game.meta.phase === 'question' || isFinal) && start) {
                  const interval = setInterval(() => {
                      const elapsed = (Date.now() - start) / 1000;
                      setTimeLeft(Math.max(0, Math.floor(duration - elapsed)));
                  }, 500);
                  return () => clearInterval(interval);
              } else setTimeLeft(0);
          }
      }, [game?.meta?.phase, game?.meta?.questionStartTime, game?.meta?.finalQuestionStartTime]);

      useEffect(() => {
          if(game?.meta?.phase === 'results') { setReveal(false); setTimeout(()=>setReveal(true), 3000); }
      }, [game?.meta?.phase]);

      useEffect(() => {
          if(game?.meta?.phase === 'roundSummary' && game.meta.categoryChooserCandidate === playerId && !game.meta.nextCategory) {
              setCatModal(true);
          } else setCatModal(false);
      }, [game?.meta, playerId]);


      /* INTERACTIONS */
      const handleSlotClick = (item, idx) => {
          if(game.meta.phase !== 'question' || freeze) return;
          if(item.type === 'TARGET') setTargetModalItem({ item, idx });
          else setConfirmationItem({ item, idx });
      };

      const confirmUseItem = async () => {
          const { item, idx } = confirmationItem;
          setConfirmationItem(null);
          await execUseItem(item, idx, null);
      };

      const execUseItem = async (item, idx, targetId) => {
          const newInv = [...(player.inventory||[])];
          newInv.splice(idx, 1);
          await db.ref(`games/${gameId}/players/${playerId}/inventory`).set(newInv);
          
          const actRef = db.ref(`games/${gameId}/meta/actions/${game.meta.questionIndex}`);
          actRef.once('value', s => {
              const arr = s.val() || [];
              arr.push({ type: item.id, from: playerId, to: targetId });
              actRef.set(arr);
          });

          if(item.type === 'TARGET' && targetId) {
              if(item.id==='POISON') {
                   const path = `games/${gameId}/players/${targetId}/activeEffects/poisonedBy`;
                   db.ref(path).once('value', s=>{ const arr=s.val()||[]; arr.push(playerId); db.ref(path).set(arr); });
              } else {
                  db.ref(`games/${gameId}/players/${targetId}/activeEffects/${item.id}`).set(true);
              }
          } else {
              db.ref(`games/${gameId}/players/${playerId}/activeEffects/${item.id}`).set(true);
          }
          setTargetModalItem(null);
      };

      const submitAnswer = (idx) => {
          if(!freeze && timeLeft > 0 && player.currentAnswer === undefined) {
              db.ref(`games/${gameId}/players/${playerId}/currentAnswer`).set(idx);
          }
      };

      if(!player || !game) return <div className="h-screen bg-black flex items-center justify-center text-white">Lade...</div>;

      const meta = game.meta;
      
      /* FINAL SCREENS PLAYER */
      if(meta.phase === 'finalIntro') {
          if(!player.isFinalist) return <div className="h-screen bg-black flex items-center justify-center text-white">Zuschauer im Finale...</div>
          return (
              <div className="h-screen bg-black flex flex-col items-center justify-center p-6 text-center">
                  <h1 className="text-[var(--rtl-orange)] text-4xl font-black mb-6">FINALE</h1>
                  <div className="text-white mb-10">Mach dich bereit!</div>
                  {!player.finalistReady ? 
                     <button className="btn btn-host w-full py-6 text-2xl" onClick={()=>db.ref(`games/${gameId}/players/${playerId}/finalistReady`).set(true)}>BEREIT</button>
                     : <div className="text-green-500 font-bold text-2xl">WARTEN...</div>
                  }
              </div>
          )
      }
      if(meta.phase === 'finalQuestion') {
          if(!player.isFinalist) return <div className="h-screen bg-black flex items-center justify-center text-white">Finale l√§uft...</div>
          const hasAns = player.finalAnswers && player.finalAnswers[meta.finalQuestionIndex];
          return (
             <div className="h-screen bg-black p-6 flex flex-col">
                 <div className="flex justify-between text-white mb-6">
                     <span>Frage {meta.finalQuestionIndex+1}</span>
                     <span className="text-[var(--rtl-orange)] font-bold">{timeLeft}s</span>
                 </div>
                 <div className="text-2xl font-black text-white mb-6">{(game.finalQuestions||[])[meta.finalQuestionIndex]?.question}</div>
                 {!hasAns ? (
                     <div className="flex flex-col gap-4">
                         <input className="text-xl p-4 text-black" placeholder="Deine Antwort..." value={finalAns} onChange={e=>setFinalAns(e.target.value)} />
                         <button className="btn btn-host py-4" onClick={()=>{
                             db.ref(`games/${gameId}/players/${playerId}/finalAnswers/${meta.finalQuestionIndex}`).set(finalAns);
                             setFinalAns('');
                         }}>ABSENDEN</button>
                     </div>
                 ) : (
                     <div className="text-[var(--rtl-orange)] text-center text-2xl font-bold mt-10">ANTWORT GESENDET</div>
                 )}
             </div>
          )
      }

      /* NORMAL GAME PLAYER */
      const q = game.questions ? game.questions[meta.questionIndex] : null;

      return (
          <div className="h-screen flex flex-col bg-[#111] relative overflow-hidden">
              
              {showRoulette && newestItem && (
                  <ItemRouletteOverlay 
                      targetItem={newestItem} 
                      onComplete={() => setShowRoulette(false)} 
                  />
              )}

              {freeze && <div className="effect-overlay effect-freeze">EISSCHOCK!</div>}

              <div className="flex justify-between items-center p-4 border-b border-white/10 bg-black">
                  <div className="text-gray-400 text-sm font-bold uppercase">Runde {meta.round}</div>
                  <div className="text-white font-black text-xl">{player.score} <span className="text-[var(--rtl-orange)] text-sm">PTS</span></div>
              </div>

              <div className="flex-1 overflow-y-auto p-4 flex flex-col">
                  
                  {meta.phase === 'question' && q && (
                      <>
                          <div className="flex justify-between items-center mb-4">
                              <span className="text-gray-500 font-bold uppercase tracking-widest text-xs">{meta.currentCategory}</span>
                              <span className={`text-3xl font-black ${timeLeft<10?'text-red-500':'text-[var(--rtl-orange)]'}`}>{timeLeft}</span>
                          </div>

                          <div className="text-xl font-bold text-white mb-6 leading-snug">{q.question}</div>

                          <div className="grid gap-3 mb-6">
                              {q.answers.map((a,i)=>{
                                  const selected = player.currentAnswer === i;
                                  return (
                                      <button 
                                          key={i}
                                          disabled={player.currentAnswer !== undefined || freeze}
                                          onClick={() => submitAnswer(i)}
                                          className={`p-4 text-left font-bold rounded-none border ${selected ? 'bg-[var(--rtl-orange)] border-[var(--rtl-orange)] text-black' : 'bg-white/5 border-white/10 text-white'} active:scale-95 transition-transform`}
                                      >
                                          {a}
                                      </button>
                                  )
                              })}
                          </div>
                      </>
                  )}

                  {meta.phase === 'results' && (
                      <div className="flex-1 flex flex-col items-center justify-center text-center">
                          {!reveal ? (
                              <div className="animate-pulse text-gray-500 font-bold text-xl">Antwort eingeloggt...</div>
                          ) : (
                              <>
                                  <div className="text-6xl mb-4">{player.currentAnswer===q.correct ? 'üòé' : 'ü´†'}</div>
                                  <h2 className="text-3xl font-black text-white mb-2">{player.currentAnswer===q.correct ? 'RICHTIG' : 'FALSCH'}</h2>
                                  <div className="text-[var(--rtl-orange)] text-5xl font-black">
                                      {player.lastPoints > 0 ? '+' : ''}{player.lastPoints}
                                  </div>
                              </>
                          )}
                      </div>
                  )}
              </div>

              <div className="bg-[#050505] p-4 border-t border-white/10">
                  <div className="text-center text-xs text-gray-600 font-black uppercase mb-2">Inventar</div>
                  <div className="flex justify-center gap-3">
                      {[0,1].map(idx => {
                          const item = (player.inventory||[])[idx];
                          if(!item) return <div key={idx} className="inventory-slot"><span className="text-gray-700 text-xl">+</span></div>;
                          return (
                              <div key={idx} onClick={()=>handleSlotClick(item, idx)} className={`inventory-slot filled rarity-${item.rarity.toLowerCase()}`}>
                                  <div className="text-2xl item-icon">{item.icon}</div>
                                  <div className={`item-tag rarity-${item.rarity.toLowerCase()}`}>{item.name}</div>
                              </div>
                          )
                      })}
                  </div>
              </div>

              {/* MODALS */}
              {confirmationItem && (
                  <div className="modal-backdrop">
                      <div className="modal-card">
                          <div className="text-4xl mb-4">{confirmationItem.item.icon}</div>
                          <h3 className="text-xl font-bold text-white mb-2">{confirmationItem.item.name} einsetzen?</h3>
                          <p className="text-gray-400 text-sm mb-6">{confirmationItem.item.desc}</p>
                          <div className="flex gap-3">
                              <button className="btn flex-1 bg-gray-700 border-gray-600" onClick={()=>setConfirmationItem(null)}>ABBRUCH</button>
                              <button className="btn btn-host flex-1" onClick={confirmUseItem}>AKTIVIEREN</button>
                          </div>
                      </div>
                  </div>
              )}

              {targetModalItem && (
                  <div className="modal-backdrop">
                      <div className="modal-card">
                          <h3 className="text-xl font-black mb-4 text-[var(--rtl-orange)]">ZIEL W√ÑHLEN</h3>
                          <div className="grid grid-cols-2 gap-2 max-h-60 overflow-y-auto mb-4">
                              {Object.entries(game.players).filter(([pid])=>pid!==playerId).map(([pid, p])=>(
                                  <button key={pid} className="btn bg-white/10" onClick={()=>execUseItem(targetModalItem.item, targetModalItem.idx, pid)}>
                                      {p.name}
                                  </button>
                              ))}
                          </div>
                          <button className="btn w-full bg-red-600 border-red-600" onClick={()=>setTargetModalItem(null)}>ABBRUCH</button>
                      </div>
                  </div>
              )}
              
              {catModal && (
                  <div className="modal-backdrop">
                      <div className="modal-card">
                          <h3 className="text-xl font-black mb-6 text-white">W√ÑHLE KATEGORIE</h3>
                          <div className="grid gap-2">
                              {CATEGORY_LIST.filter(c=>!game.meta.categoryState.used.includes(c)).map(c=>(
                                  <button key={c} className="btn btn-host w-full" onClick={()=>db.ref(`games/${gameId}/meta/nextCategory`).set(c)}>{c}</button>
                              ))}
                          </div>
                      </div>
                  </div>
              )}

          </div>
      );
  }

  function App(){
    const [mode,setMode] = useState('start');
    const [gameId,setGameId] = useState('');
    const [playerId,setPlayerId] = useState('');

    useEffect(()=>{
        const urlParams = new URLSearchParams(window.location.search);
        const join = urlParams.get('join');
        if(join) { setGameId(join); setMode('join'); }
    }, []);

    const handleCreate = async (name) => {
        const gid = randomGameID();
        setGameId(gid);
        setMode('host');
    };
    const handleJoin = async (name, code) => {
        const pid = makePlayerId();
        await db.ref(`games/${code}/players/${pid}`).set({ name, score: 0, inventory: [] });
        setGameId(code);
        setPlayerId(pid);
        setMode('player');
    };

    if(mode==='start') return <StartScreen onCreate={handleCreate} onJoin={(n,c)=>{setGameId(c); setMode('join');}} />;
    if(mode==='host') return <HostScreen gameId={gameId} />;
    if(mode==='join') return <StartScreen onCreate={()=>{}} onJoin={handleJoin} />;
    if(mode==='player') return <PlayerView gameId={gameId} playerId={playerId} />;
    return null;
  }

  const root = ReactDOM.createRoot(document.getElementById('root'));
  root.render(<App />);
  </script>
</body>
</html>
