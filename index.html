<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Game</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase direkt laden -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script>
        // Warte bis React geladen ist
        window.addEventListener('load', function() {
        const { useState, useEffect } = React;

        const TOTAL_ROUNDS = 4;
        const QUESTIONS_PER_ROUND = 8;
        const QUESTION_TIME = 20;

        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyCsxAEsivsJVFVcnerdAWezFpruoCv7Z2I",
            authDomain: "qiuz-64055.firebaseapp.com",
            databaseURL: "https://qiuz-64055-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "qiuz-64055",
            storageBucket: "qiuz-64055.firebasestorage.app",
            messagingSenderId: "605853616985",
            appId: "1:605853616985:web:95579b246a10d89ba51a48"
        };

        const sampleQuestions = [
            { question: "Was ist die Hauptstadt von √ñsterreich?", answers: ["Wien", "Graz", "Salzburg", "Innsbruck"], correct: 0 },
            { question: "Welcher Planet ist der gr√∂√üte in unserem Sonnensystem?", answers: ["Mars", "Saturn", "Jupiter", "Neptun"], correct: 2 },
            { question: "Wer malte die Mona Lisa?", answers: ["Picasso", "Van Gogh", "Da Vinci", "Monet"], correct: 2 },
            { question: "In welchem Jahr fiel die Berliner Mauer?", answers: ["1987", "1989", "1991", "1993"], correct: 1 },
            { question: "Was ist die chemische Formel f√ºr Wasser?", answers: ["CO2", "H2O", "O2", "NaCl"], correct: 1 },
            { question: "Welches ist der l√§ngste Fluss der Welt?", answers: ["Nil", "Amazonas", "Yangtze", "Mississippi"], correct: 0 },
            { question: "Wie viele Kontinente gibt es?", answers: ["5", "6", "7", "8"], correct: 2 },
            { question: "Welches Tier ist das schnellste an Land?", answers: ["L√∂we", "Gepard", "Antilope", "Pferd"], correct: 1 },
            { question: "Wer schrieb 'Romeo und Julia'?", answers: ["Goethe", "Shakespeare", "Schiller", "Kafka"], correct: 1 },
            { question: "Welches ist das gr√∂√üte S√§ugetier?", answers: ["Elefant", "Blauwal", "Giraffe", "Nilpferd"], correct: 1 },
            { question: "In welchem Land steht der Eiffelturm?", answers: ["Italien", "Spanien", "Frankreich", "Deutschland"], correct: 2 },
            { question: "Wie viele Stunden hat ein Tag?", answers: ["12", "24", "36", "48"], correct: 1 },
            { question: "Was ist 7 x 8?", answers: ["54", "56", "58", "64"], correct: 1 },
            { question: "Welche Farbe hat ein Smaragd?", answers: ["Rot", "Blau", "Gr√ºn", "Gelb"], correct: 2 },
            { question: "Wie hei√üt die Hauptstadt von Deutschland?", answers: ["M√ºnchen", "Hamburg", "Berlin", "K√∂ln"], correct: 2 },
            { question: "Welcher Ozean ist der gr√∂√üte?", answers: ["Atlantik", "Indischer", "Pazifik", "Arktis"], correct: 2 },
            { question: "Wie viele Beine hat eine Spinne?", answers: ["6", "8", "10", "12"], correct: 1 },
            { question: "Was ist die Hauptstadt der USA?", answers: ["New York", "Los Angeles", "Chicago", "Washington D.C."], correct: 3 },
            { question: "Welches Instrument hat 88 Tasten?", answers: ["Gitarre", "Klavier", "Orgel", "Keyboard"], correct: 1 },
            { question: "In welcher Stadt steht die Freiheitsstatue?", answers: ["Boston", "New York", "Chicago", "Miami"], correct: 1 },
            { question: "Wie viele Seiten hat ein W√ºrfel?", answers: ["4", "6", "8", "10"], correct: 1 },
            { question: "Welches Gas atmen wir ein?", answers: ["Sauerstoff", "Stickstoff", "Kohlendioxid", "Helium"], correct: 0 },
            { question: "Wie hei√üt der h√∂chste Berg der Welt?", answers: ["K2", "Mount Everest", "Kilimandscharo", "Mont Blanc"], correct: 1 },
            { question: "Welcher Planet ist der Erde am n√§chsten?", answers: ["Mars", "Venus", "Merkur", "Jupiter"], correct: 1 },
            { question: "Wie viele Bundesl√§nder hat √ñsterreich?", answers: ["7", "9", "11", "13"], correct: 1 },
            { question: "Was ist die Quadratwurzel von 64?", answers: ["6", "8", "10", "12"], correct: 1 },
            { question: "Welches Tier legt Eier?", answers: ["Katze", "Hund", "Huhn", "Kuh"], correct: 2 },
            { question: "Wie viele Minuten hat eine Stunde?", answers: ["30", "45", "60", "90"], correct: 2 },
            { question: "Welche Farbe entsteht aus Rot und Gelb?", answers: ["Gr√ºn", "Orange", "Lila", "Braun"], correct: 1 },
            { question: "In welchem Jahr begann das 21. Jahrhundert?", answers: ["1999", "2000", "2001", "2002"], correct: 2 },
            { question: "Wie hei√üt die Hauptstadt von Spanien?", answers: ["Barcelona", "Madrid", "Valencia", "Sevilla"], correct: 1 },
            { question: "Welches Element hat das Symbol 'Au'?", answers: ["Silber", "Gold", "Kupfer", "Eisen"], correct: 1 },
        ];

        const generateQuestions = () => {
            const shuffled = [...sampleQuestions].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, TOTAL_ROUNDS * QUESTIONS_PER_ROUND).map((q, i) => ({ ...q, id: i }));
        };

        class FirebaseDB {
            constructor() {
                this.db = null;
                this.initialized = false;
            }

            async init() {
                if (this.initialized) return;
                
                try {
                    console.log('Firebase init gestartet...');
                    
                    // Firebase sollte jetzt schon geladen sein
                    if (!window.firebase) {
                        throw new Error('Firebase nicht geladen!');
                    }

                    if (!window.firebase.apps.length) {
                        window.firebase.initializeApp(FIREBASE_CONFIG);
                        console.log('Firebase App initialisiert');
                    }
                    
                    this.db = window.firebase.database();
                    this.initialized = true;
                    console.log('Firebase Database bereit:', this.db);
                } catch (error) {
                    console.error('Firebase init error:', error);
                    alert('Firebase Fehler: ' + error.message);
                    throw error;
                }
            }

            async createGame(gameId, initialState) {
                try {
                    await this.init();
                    console.log('Erstelle Spiel:', gameId, initialState);
                    await this.db.ref(`games/${gameId}`).set(initialState);
                    console.log('Spiel erfolgreich erstellt!');
                } catch (error) {
                    console.error('Fehler beim Erstellen:', error);
                    alert('Fehler beim Erstellen: ' + error.message);
                }
            }

            async updateGame(gameId, updates) {
                try {
                    await this.init();
                    console.log('Update Spiel:', gameId, updates);
                    await this.db.ref(`games/${gameId}`).update(updates);
                    console.log('Update erfolgreich');
                } catch (error) {
                    console.error('Update Fehler:', error);
                }
            }

            async onGameChange(gameId, callback) {
                try {
                    await this.init();
                    console.log('Listener hinzugef√ºgt f√ºr:', gameId);
                    this.db.ref(`games/${gameId}`).on('value', (snapshot) => {
                        const data = snapshot.val();
                        console.log('Daten empfangen:', data);
                        callback(data);
                    }, (error) => {
                        console.error('Listener Fehler:', error);
                        alert('Fehler beim Laden: ' + error.message);
                    });
                } catch (err) {
                    console.error('onGameChange Fehler:', err);
                    alert('Fehler beim Verbinden: ' + err.message);
                }
            }

            offGameChange(gameId) {
                if (!this.initialized || !this.db) return;
                this.db.ref(`games/${gameId}`).off();
            }
        }

        const db = new FirebaseDB();

        // SVG Icons als Komponenten
        const WifiIcon = () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "64", height: "64", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
            React.createElement('path', { d: "M5 12.55a11 11 0 0 1 14.08 0" }),
            React.createElement('path', { d: "M1.42 9a16 16 0 0 1 21.16 0" }),
            React.createElement('path', { d: "M8.53 16.11a6 6 0 0 1 6.95 0" }),
            React.createElement('line', { x1: "12", y1: "20", x2: "12.01", y2: "20" })
        );

        const UsersIcon = ({ size = 24 }) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: size, height: size, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
            React.createElement('path', { d: "M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" }),
            React.createElement('circle', { cx: "9", cy: "7", r: "4" }),
            React.createElement('path', { d: "M22 21v-2a4 4 0 0 0-3-3.87" }),
            React.createElement('path', { d: "M16 3.13a4 4 0 0 1 0 7.75" })
        );

        const PlayIcon = () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
            React.createElement('polygon', { points: "5 3 19 12 5 21 5 3" })
        );

        const ClockIcon = () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "32", height: "32", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
            React.createElement('circle', { cx: "12", cy: "12", r: "10" }),
            React.createElement('polyline', { points: "12 6 12 12 16 14" })
        );

        const CheckCircleIcon = ({ size = 96 }) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: size, height: size, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
            React.createElement('path', { d: "M22 11.08V12a10 10 0 1 1-5.93-9.14" }),
            React.createElement('polyline', { points: "22 4 12 14.01 9 11.01" })
        );

        const XCircleIcon = ({ size = 96 }) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: size, height: size, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
            React.createElement('circle', { cx: "12", cy: "12", r: "10" }),
            React.createElement('line', { x1: "15", y1: "9", x2: "9", y2: "15" }),
            React.createElement('line', { x1: "9", y1: "9", x2: "15", y2: "15" })
        );

        const TrophyIcon = ({ size = 64 }) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: size, height: size, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
            React.createElement('path', { d: "M6 9H4.5a2.5 2.5 0 0 1 0-5H6" }),
            React.createElement('path', { d: "M18 9h1.5a2.5 2.5 0 0 0 0-5H18" }),
            React.createElement('path', { d: "M4 22h16" }),
            React.createElement('path', { d: "M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" }),
            React.createElement('path', { d: "M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" }),
            React.createElement('path', { d: "M18 2H6v7a6 6 0 0 0 12 0V2Z" })
        );

        const CopyIcon = () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
            React.createElement('rect', { x: "9", y: "9", width: "13", height: "13", rx: "2", ry: "2" }),
            React.createElement('path', { d: "M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" })
        );

        const CheckIcon = () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
            React.createElement('polyline', { points: "20 6 9 17 4 12" })
        );

        function QRCode({ gameId }) {
            const [copied, setCopied] = useState(false);
            const url = `${window.location.origin}${window.location.pathname}?join=${gameId}`;
            
            const copyToClipboard = () => {
                navigator.clipboard.writeText(url);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            return React.createElement('div', { className: "bg-white p-6 rounded-lg shadow-lg text-center" },
                React.createElement('div', { className: "mb-4" },
                    React.createElement('div', { className: "bg-gradient-to-br from-blue-50 to-purple-50 w-full p-8 rounded-lg border-2 border-blue-200" },
                        React.createElement(WifiIcon),
                        React.createElement('p', { className: "text-sm font-mono text-gray-700 break-all mb-4 mt-4" }, url),
                        React.createElement('button', {
                            onClick: copyToClipboard,
                            className: "bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 mx-auto hover:bg-blue-600"
                        },
                            copied ? React.createElement(CheckIcon) : React.createElement(CopyIcon),
                            copied ? 'Kopiert!' : 'Link kopieren'
                        )
                    )
                ),
                React.createElement('p', { className: "text-2xl font-bold" }, `Game ID: ${gameId}`),
                React.createElement('p', { className: "text-sm text-gray-600 mt-2" }, "√ñffne den Link am Handy zum Beitreten")
            );
        }

        function HostView({ gameState, onStartGame, onNextQuestion, onShowResults, onNewGame }) {
            const [timeLeft, setTimeLeft] = useState(QUESTION_TIME);

            // Sicherheitscheck f√ºr gameState
            if (!gameState || !gameState.players || !gameState.questions) {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center" },
                    React.createElement('div', { className: "text-white text-2xl font-bold" }, "Lade Spiel...")
                );
            }

            useEffect(() => {
                if (gameState.phase === 'question' && timeLeft > 0) {
                    const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);
                    return () => clearTimeout(timer);
                } else if (gameState.phase === 'question' && timeLeft === 0) {
                    onShowResults();
                }
            }, [gameState.phase, timeLeft, onShowResults]);

            useEffect(() => {
                if (gameState.phase === 'question') {
                    setTimeLeft(QUESTION_TIME);
                }
            }, [gameState.currentQuestion]);

            const currentQ = gameState.questions[gameState.currentQuestion];
            const round = Math.floor(gameState.currentQuestion / QUESTIONS_PER_ROUND) + 1;
            const questionInRound = (gameState.currentQuestion % QUESTIONS_PER_ROUND) + 1;

            if (gameState.phase === 'lobby') {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-purple-600 to-blue-600 p-8" },
                    React.createElement('div', { className: "max-w-6xl mx-auto" },
                        React.createElement('h1', { className: "text-6xl font-bold text-white text-center mb-12" }, "üéØ Quiz Spiel"),
                        React.createElement('div', { className: "grid md:grid-cols-2 gap-8" },
                            React.createElement(QRCode, { gameId: gameState.gameId }),
                            React.createElement('div', { className: "bg-white p-6 rounded-lg shadow-lg" },
                                React.createElement('h2', { className: "text-2xl font-bold mb-4 flex items-center gap-2" },
                                    React.createElement(UsersIcon, { size: 24 }),
                                    `Spieler (${gameState.players.length}/4)`
                                ),
                                React.createElement('div', { className: "space-y-3 max-h-64 overflow-y-auto" },
                                    gameState.players.map((p) =>
                                        React.createElement('div', { key: p.id, className: "bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg flex items-center justify-between border-2 border-blue-200" },
                                            React.createElement('span', { className: "font-semibold text-lg" }, p.name),
                                            React.createElement('span', { className: "text-sm text-gray-600 bg-white px-3 py-1 rounded-full" }, "Bereit")
                                        )
                                    ),
                                    gameState.players.length === 0 && React.createElement('p', { className: "text-gray-500 text-center py-12" }, "Warte auf Spieler...")
                                ),
                                React.createElement('button', {
                                    onClick: onStartGame,
                                    disabled: gameState.players.length === 0,
                                    className: "w-full mt-6 bg-green-500 text-white py-4 rounded-lg font-bold text-lg flex items-center justify-center gap-2 hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition"
                                },
                                    React.createElement(PlayIcon),
                                    "Spiel Starten"
                                )
                            )
                        )
                    )
                );
            }

            if (gameState.phase === 'question') {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-indigo-600 to-purple-600 p-8" },
                    React.createElement('div', { className: "max-w-6xl mx-auto" },
                        React.createElement('div', { className: "bg-white rounded-lg shadow-2xl p-8" },
                            React.createElement('div', { className: "flex justify-between items-center mb-8" },
                                React.createElement('div', { className: "text-lg font-bold text-gray-700 bg-gray-100 px-6 py-3 rounded-lg" },
                                    `Runde ${round} / ${TOTAL_ROUNDS} ‚Ä¢ Frage ${questionInRound} / ${QUESTIONS_PER_ROUND}`
                                ),
                                React.createElement('div', { className: "flex items-center gap-3 text-3xl font-bold bg-red-50 px-6 py-3 rounded-lg" },
                                    React.createElement(ClockIcon),
                                    React.createElement('span', { className: timeLeft <= 5 ? 'text-red-500 animate-pulse' : 'text-gray-700' }, `${timeLeft}s`)
                                )
                            ),
                            React.createElement('h2', { className: "text-4xl font-bold mb-12 text-center text-gray-800" }, currentQ.question),
                            React.createElement('div', { className: "grid grid-cols-2 gap-6" },
                                currentQ.answers.map((answer, i) => {
                                    const votes = gameState.players.filter(p => p.currentAnswer === i).length;
                                    const colors = ['bg-blue-100 border-blue-400', 'bg-green-100 border-green-400', 'bg-yellow-100 border-yellow-400', 'bg-purple-100 border-purple-400'];
                                    
                                    return React.createElement('div', { key: i, className: `${colors[i]} p-8 rounded-xl border-4 transition transform hover:scale-105` },
                                        React.createElement('div', { className: "text-2xl font-bold mb-3" }, answer),
                                        React.createElement('div', { className: "flex items-center gap-2" },
                                            React.createElement(UsersIcon, { size: 20 }),
                                            React.createElement('span', { className: "text-lg font-semibold text-gray-700" },
                                                `${votes} ${votes === 1 ? 'Spieler' : 'Spieler'}`
                                            )
                                        )
                                    );
                                })
                            )
                        )
                    )
                );
            }

            if (gameState.phase === 'results') {
                const isLastQuestion = gameState.currentQuestion === gameState.questions.length - 1;

                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-green-600 to-teal-600 p-8" },
                    React.createElement('div', { className: "max-w-6xl mx-auto" },
                        React.createElement('div', { className: "bg-white rounded-lg shadow-2xl p-8" },
                            React.createElement('h2', { className: "text-4xl font-bold mb-8 text-center" }, "üìä Ergebnisse"),
                            React.createElement('div', { className: "mb-8" },
                                React.createElement('p', { className: "text-2xl font-semibold mb-6 text-center text-gray-700" }, currentQ.question),
                                React.createElement('div', { className: "grid grid-cols-2 gap-6" },
                                    currentQ.answers.map((answer, i) => {
                                        const isCorrect = i === currentQ.correct;
                                        const voters = gameState.players.filter(p => p.currentAnswer === i);
                                        
                                        return React.createElement('div', {
                                            key: i,
                                            className: `p-6 rounded-xl border-4 transition transform ${isCorrect ? 'bg-green-100 border-green-500 scale-105' : 'bg-red-50 border-red-300'}`
                                        },
                                            React.createElement('div', { className: "flex items-center gap-3 mb-3" },
                                                isCorrect ? React.createElement(CheckCircleIcon, { size: 32 }) : React.createElement(XCircleIcon, { size: 32 }),
                                                React.createElement('span', { className: "text-2xl font-bold" }, answer)
                                            ),
                                            React.createElement('div', { className: "text-base text-gray-700" },
                                                voters.length > 0 ? voters.map(p => p.name).join(', ') : 'Niemand'
                                            )
                                        );
                                    })
                                )
                            ),
                            React.createElement('div', { className: "bg-gradient-to-r from-yellow-50 to-orange-50 p-8 rounded-xl mb-8 border-2 border-yellow-300" },
                                React.createElement('h3', { className: "text-2xl font-bold mb-6 flex items-center gap-2" },
                                    React.createElement(TrophyIcon, { size: 32 }),
                                    "Punktestand"
                                ),
                                React.createElement('div', { className: "space-y-3" },
                                    [...gameState.players].sort((a, b) => b.score - a.score).map((p, i) =>
                                        React.createElement('div', { key: p.id, className: "flex justify-between items-center bg-white p-4 rounded-lg shadow" },
                                            React.createElement('span', { className: "font-bold text-lg" },
                                                `${i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : ''} ${i + 1}. ${p.name}`
                                            ),
                                            React.createElement('span', { className: "text-2xl font-bold text-blue-600" }, `${p.score} Punkte`)
                                        )
                                    )
                                )
                            ),
                            React.createElement('button', {
                                onClick: isLastQuestion ? onNewGame : onNextQuestion,
                                className: "w-full bg-blue-500 text-white py-4 rounded-lg font-bold text-xl hover:bg-blue-600 transition"
                            }, isLastQuestion ? 'üéÆ Neues Spiel' : '‚û°Ô∏è N√§chste Frage')
                        )
                    )
                );
            }

            return null;
        }

        function PlayerView({ playerId, gameState, onJoinGame, onAnswer }) {
            const [name, setName] = useState('');
            
            // Sicherheitscheck f√ºr gameState
            if (!gameState || !gameState.players || !gameState.questions) {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center" },
                    React.createElement('div', { className: "text-white text-2xl font-bold" }, "Lade Spiel...")
                );
            }

            const player = gameState.players.find(p => p.id === playerId);
            const currentQ = gameState.questions[gameState.currentQuestion];

            if (!player) {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 p-4 flex items-center justify-center" },
                    React.createElement('div', { className: "bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full" },
                        React.createElement('h2', { className: "text-3xl font-bold mb-6 text-center" }, "üéØ Quiz Beitreten"),
                        React.createElement('p', { className: "text-gray-600 text-center mb-6" }, `Game: ${gameState.gameId}`),
                        React.createElement('input', {
                            type: "text",
                            value: name,
                            onChange: (e) => setName(e.target.value),
                            placeholder: "Dein Name",
                            className: "w-full p-4 border-2 border-gray-300 rounded-lg mb-4 text-lg",
                            maxLength: 20
                        }),
                        React.createElement('button', {
                            onClick: () => name.trim() && onJoinGame(name.trim()),
                            disabled: !name.trim() || gameState.players.length >= 4,
                            className: "w-full bg-green-500 text-white py-4 rounded-lg font-bold text-lg hover:bg-green-600 disabled:bg-gray-300 transition"
                        }, gameState.players.length >= 4 ? 'Spiel voll' : 'Beitreten')
                    )
                );
            }

            if (gameState.phase === 'lobby') {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-purple-600 to-blue-600 p-4 flex items-center justify-center" },
                    React.createElement('div', { className: "bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full text-center" },
                        React.createElement(UsersIcon, { size: 80 }),
                        React.createElement('h2', { className: "text-3xl font-bold mb-4 mt-4" }, `Willkommen, ${player.name}! üëã`),
                        React.createElement('p', { className: "text-gray-600 text-lg mb-6" }, "Warte auf den Spielstart..."),
                        React.createElement('div', { className: "text-left bg-blue-50 p-6 rounded-lg" },
                            React.createElement('p', { className: "font-bold mb-3 text-lg" }, "Spieler im Spiel:"),
                            React.createElement('div', { className: "space-y-2" },
                                gameState.players.map((p) =>
                                    React.createElement('div', { key: p.id, className: "bg-white p-3 rounded-lg shadow flex items-center gap-2" },
                                        React.createElement('div', { className: "w-2 h-2 bg-green-500 rounded-full" }),
                                        p.name
                                    )
                                )
                            )
                        )
                    )
                );
            }

            if (gameState.phase === 'question') {
                const hasAnswered = player.currentAnswer !== null;
                const colors = ['bg-blue-500', 'bg-green-500', 'bg-yellow-500', 'bg-purple-500'];
                
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-indigo-600 to-purple-600 p-4" },
                    React.createElement('div', { className: "max-w-2xl mx-auto" },
                        React.createElement('div', { className: "bg-white rounded-2xl shadow-2xl p-6" },
                            React.createElement('h3', { className: "text-2xl font-bold mb-6 text-center" }, currentQ.question),
                            hasAnswered ? 
                                React.createElement('div', { className: "text-center py-16" },
                                    React.createElement(CheckCircleIcon, { size: 96 }),
                                    React.createElement('p', { className: "text-2xl font-bold mt-4" }, "Antwort abgegeben! ‚úì"),
                                    React.createElement('p', { className: "text-gray-600 mt-3 text-lg" }, "Warte auf andere Spieler...")
                                )
                            :
                                React.createElement('div', { className: "space-y-4" },
                                    currentQ.answers.map((answer, i) =>
                                        React.createElement('button', {
                                            key: i,
                                            onClick: () => onAnswer(i),
                                            className: `w-full ${colors[i]} text-white p-6 rounded-xl text-xl font-bold hover:opacity-90 active:scale-95 transition transform shadow-lg`
                                        }, answer)
                                    )
                                )
                        )
                    )
                );
            }

            if (gameState.phase === 'results') {
                const wasCorrect = player.currentAnswer === currentQ.correct;
                const rank = [...gameState.players].sort((a, b) => b.score - a.score).findIndex(p => p.id === playerId) + 1;

                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-green-600 to-teal-600 p-4" },
                    React.createElement('div', { className: "max-w-2xl mx-auto" },
                        React.createElement('div', { className: "bg-white rounded-2xl shadow-2xl p-8" },
                            React.createElement('div', { className: "text-center mb-8" },
                                wasCorrect ?
                                    React.createElement(React.Fragment, null,
                                        React.createElement(CheckCircleIcon, { size: 96 }),
                                        React.createElement('h3', { className: "text-4xl font-bold text-green-600 mt-4" }, "Richtig! üéâ"),
                                        React.createElement('p', { className: "text-xl text-gray-600 mt-2" }, "+100 Punkte")
                                    )
                                :
                                    React.createElement(React.Fragment, null,
                                        React.createElement(XCircleIcon, { size: 96 }),
                                        React.createElement('h3', { className: "text-4xl font-bold text-red-600 mt-4" }, "Falsch! üòï")
                                    )
                            ),
                            React.createElement('div', { className: "bg-blue-50 p-6 rounded-xl mb-8 border-2 border-blue-200" },
                                React.createElement('p', { className: "text-center font-bold text-lg mb-2" }, "Richtige Antwort:"),
                                React.createElement('p', { className: "text-center text-2xl font-bold text-green-600" }, currentQ.answers[currentQ.correct])
                            ),
                            React.createElement('div', { className: "text-center bg-gradient-to-r from-yellow-50 to-orange-50 p-6 rounded-xl border-2 border-yellow-300" },
                                React.createElement(TrophyIcon, { size: 64 }),
                                React.createElement('p', { className: "text-lg mb-2 mt-3" }, "Dein Punktestand:"),
                                React.createElement('p', { className: "text-4xl font-bold text-blue-600 mb-3" }, player.score),
                                React.createElement('p', { className: "text-gray-600 text-lg" },
                                    `${rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : ''} Platz ${rank} von ${gameState.players.length}`
                                )
                            )
                        )
                    )
                );
            }

            return null;
        }

        function QuizGame() {
            const [gameState, setGameState] = useState(null);
            const [playerId, setPlayerId] = useState(null);
            const [isHost, setIsHost] = useState(true);
            const [gameId, setGameId] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                console.log('QuizGame useEffect gestartet');
                const params = new URLSearchParams(window.location.search);
                const joinId = params.get('join');
                
                if (joinId) {
                    console.log('Join Mode - Game ID:', joinId);
                    setIsHost(false);
                    setGameId(joinId);
                    db.onGameChange(joinId, (data) => {
                        console.log('Join - Daten erhalten:', data);
                        if (data) {
                            setGameState(data);
                        } else {
                            console.error('Kein Spiel gefunden!');
                        }
                        setLoading(false);
                    });
                } else {
                    console.log('Host Mode - Erstelle neues Spiel');
                    const newGameId = Math.random().toString(36).substr(2, 6).toUpperCase();
                    console.log('Neue Game ID:', newGameId);
                    setGameId(newGameId);
                    const initialState = {
                        gameId: newGameId,
                        phase: 'lobby',
                        players: [],
                        questions: generateQuestions(),
                        currentQuestion: 0
                    };
                    
                    console.log('Initial State:', initialState);
                    
                    db.createGame(newGameId, initialState).then(() => {
                        console.log('Spiel erstellt, starte Listener');
                        db.onGameChange(newGameId, (data) => {
                            console.log('Host - Daten erhalten:', data);
                            if (data) {
                                setGameState(data);
                            }
                            setLoading(false);
                        });
                    }).catch(err => {
                        console.error('Fehler beim Erstellen:', err);
                        alert('Fehler: ' + err.message);
                        setLoading(false);
                    });
                }

                return () => {
                    console.log('Cleanup');
                    if (gameId) db.offGameChange(gameId);
                };
            }, []);

            const handleJoinGame = async (name) => {
                if (!gameState || gameState.players.length >= 4) return;
                const newPlayerId = Date.now().toString();
                setPlayerId(newPlayerId);
                
                const updatedPlayers = [...gameState.players, { 
                    id: newPlayerId, 
                    name, 
                    score: 0, 
                    currentAnswer: null 
                }];
                
                await db.updateGame(gameId, { players: updatedPlayers });
            };

            const handleStartGame = async () => {
                await db.updateGame(gameId, { phase: 'question' });
            };

            const handleAnswer = async (answerIndex) => {
                const updatedPlayers = gameState.players.map(p =>
                    p.id === playerId ? { ...p, currentAnswer: answerIndex } : p
                );
                await db.updateGame(gameId, { players: updatedPlayers });
            };

            const handleShowResults = async () => {
                const currentQ = gameState.questions[gameState.currentQuestion];
                const updatedPlayers = gameState.players.map(p => ({
                    ...p,
                    score: p.currentAnswer === currentQ.correct ? p.score + 100 : p.score
                }));
                
                await db.updateGame(gameId, { 
                    phase: 'results',
                    players: updatedPlayers
                });
            };

            const handleNextQuestion = async () => {
                const updatedPlayers = gameState.players.map(p => ({ 
                    ...p, 
                    currentAnswer: null 
                }));
                
                await db.updateGame(gameId, {
                    phase: 'question',
                    currentQuestion: gameState.currentQuestion + 1,
                    players: updatedPlayers
                });
            };

            const handleNewGame = async () => {
                const updatedPlayers = gameState.players.map(p => ({ 
                    ...p, 
                    score: 0, 
                    currentAnswer: null 
                }));
                
                await db.updateGame(gameId, {
                    phase: 'lobby',
                    players: updatedPlayers,
                    questions: generateQuestions(),
                    currentQuestion: 0
                });
            };

            if (loading) {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center" },
                    React.createElement('div', { className: "text-white text-2xl font-bold" }, "Lade Spiel...")
                );
            }

            if (!gameState) {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-red-600 to-pink-600 flex items-center justify-center p-4" },
                    React.createElement('div', { className: "bg-white p-8 rounded-2xl shadow-2xl max-w-md text-center" },
                        React.createElement(XCircleIcon, { size: 64 }),
                        React.createElement('h2', { className: "text-2xl font-bold mb-2 mt-4" }, "Spiel nicht gefunden"),
                        React.createElement('p', { className: "text-gray-600" }, "Bitte √ºberpr√ºfe die Game ID.")
                    )
                );
            }

            if (isHost) {
                return React.createElement(HostView, {
                    gameState: gameState,
                    onStartGame: handleStartGame,
                    onNextQuestion: handleNextQuestion,
                    onShowResults: handleShowResults,
                    onNewGame: handleNewGame
                });
            }

            return React.createElement(PlayerView, {
                playerId: playerId,
                gameState: gameState,
                onJoinGame: handleJoinGame,
                onAnswer: handleAnswer
            });
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(QuizGame));
        }); // Ende von window.onload
    </script>
</body>
</html>
</html>

